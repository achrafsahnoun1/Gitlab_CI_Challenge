variables:
  HUGO_IMAGE: klakegg/hugo:0.107.0-ext-ubuntu-onbuild
  PROJECT_IMAGE_TAG: $CI_COMMIT_SHORT_SHA
  ENVIRONMENT: draft

workflow:
  rules:
    - if: '$CI_COMMIT_BRANCH =~ /^feature-.*$/'
    - if: '$CI_COMMIT_BRANCH =~ /main|master/'
    - if: '$CI_COMMIT_TAG =~ /^[0-9]+\.[0-9]+\.[0-9]+$/'
      variables:
        PORT: 8080
        CONTAINER_NAME: blog-prod
        ENVIRONMENT: production
        ARTIFACT_LINK: "https://gitlab.com/api/v4/projects/$CI_PROJECT_ID/jobs/artifacts/$CI_DEFAULT_BRANCH/download?job=build"
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
      variables:
        PORT: 8082
        CONTAINER_NAME: blog-dev
        ENVIRONMENT: development
        ARTIFACT_LINK: "https://gitlab.com/api/v4/projects/$CI_PROJECT_ID/jobs/artifacts/$CI_MERGE_REQUEST_SOURCE_BRANCH_NAME/download?job=build"

stages:
  - build üî®
  - package üì¶
  - deploy üåç

build:
  stage: build üî®
  tags:
    - docker
  script:
    - echo "TODO"

package:
  stage: package üì¶
  tags:
    - docker
  variables:
    HEADER: "PRIVATE-TOKEN: $PRIVATE_TOKEN" # Please create an access token with `read_api` scope 
  script:
    - echo "TODO" 

deploy:
  stage: deploy üåç
  environment: $ENVIRONMENT
  tags:
    - shell
  script:
    - echo "TODO"